# Headless Functionality

Headless functions are API calls that do not display UI. Most require the SDK to be initialized and the user to be configured/logged in.

## Error Handling

`LucraSDK` throws errors with `code` values that you should map to user actions:

- `notInitialized`: SDK not ready or user not configured.
- `unverified`: User must verify identity.
- `notAllowed`: User is not permitted to perform the action.
- `insufficientFunds`: User must add funds.
- `missingDemographicInformation`: User must complete demographics.
- `unknown`: Unexpected error.

Example:

```ts
import { LucraSDK, type LucraSDKError } from '@lucra-sports/lucra-react-native-sdk';

function handleLucraSDKError(e: LucraSDKError) {
  switch (e.code) {
    case 'notInitialized':
      LucraSDK.present({ name: LucraSDK.FLOW.ONBOARDING });
      break;
    case 'unverified':
      LucraSDK.present({ name: LucraSDK.FLOW.VERIFY_IDENTITY });
      break;
    case 'insufficientFunds':
      LucraSDK.present({ name: LucraSDK.FLOW.ADD_FUNDS });
      break;
    case 'missingDemographicInformation':
      LucraSDK.present({ name: LucraSDK.FLOW.DEMOGRAPHIC_COLLECTION });
      break;
    default:
      console.warn('Lucra error', e);
  }
}
```

## User Configuration

Provide user information so Lucra can create or update the user profile:

```ts
await LucraSDK.configureUser({
  firstName: 'Mike',
  address: {
    address: 'New York',
  },
});

const user = await LucraSDK.getUser();
```

### Required/Optional Fields

Field requirements depend on your program configuration. At minimum, pass the fields you have available. The SDK will prompt for missing information when necessary.

## Logout

```ts
await LucraSDK.logout();
```

Ends the Lucra session for the current user.

## Games Matchups (Headless)

Create and accept recreational games, then fetch the matchup to inspect its state.

```ts
const { matchupId } = await LucraSDK.createRecreationalGame(
  'GAME_TYPE_ID',
  { type: 'cash', amount: 10 },
  'groupvsgroup'
);

const matchup = await LucraSDK.getMatchup(matchupId);
```

`matchup` response shape (example):

```json
{
  "id": "matchup-id",
  "createdAt": "2024-01-01T00:00:00Z",
  "updatedAt": "2024-01-01T00:00:00Z",
  "creatorId": "user-123",
  "status": "OPEN",
  "subtype": "RECREATIONAL",
  "type": "GAMES",
  "isPublic": true,
  "winningGroupId": null,
  "creator": {
    "id": "user-123",
    "username": "alice",
    "avatarUrl": null,
    "socialConnectionId": null,
    "loyaltyPoints": 0
  },
  "participantGroups": [
    {
      "id": "team-a",
      "createdAt": "2024-01-01T00:00:00Z",
      "outcome": "UNKNOWN",
      "participants": [
        {
          "wager": 5,
          "user": {
            "id": "user-123",
            "username": "alice",
            "avatarUrl": null,
            "socialConnectionId": null,
            "loyaltyPoints": 0
          },
          "reward": null,
          "tournamentLeaderboard": null
        }
      ],
      "recreationalGameStatDetails": null,
      "professionalPlayerStatDetails": null,
      "professionalTeamStatDetails": null
    }
  ],
  "recreationGameExtension": {
    "gameId": "GAME_TYPE_ID",
    "buyInAmount": 10,
    "game": {
      "id": "GAME_TYPE_ID",
      "name": "Ping Pong",
      "description": "Friendly match",
      "iconUrl": "https://...",
      "imageUrl": "https://...",
      "imageBgUrl": "https://...",
      "categoryIds": ["indoor"],
      "groupTitle": "Games",
      "isFeatured": false,
      "howToWin": "Score 21 points",
      "moreInfoHowToWin": null,
      "moreInfoTrackResults": null
    }
  }
}
```
## User Listener

Subscribe to user updates:

```ts
const unsubscribe = LucraSDK.addListener('user', ({ user, error }) => {
  if (error) {
    console.log('user callback error', error);
    return;
  }

  if (user == null) {
    console.log('User is null (logged out)');
  } else {
    console.log('Received user', user);
  }
});

// Call this when you no longer need the listener (e.g., on unmount).
unsubscribe();
```

## Full Screen Flow Dismissed Listener

```ts
const unsubscribe = LucraSDK.addLucraFlowDismissedListener((flow) => {
  console.log('flow dismissed', flow);
});

// Call this when you no longer need the listener (e.g., on unmount).
unsubscribe();
```
