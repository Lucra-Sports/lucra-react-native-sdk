# Tournament Headless Functions

[Lucra Headless setup](1.2.9_headless_interactions.md)

Use these headless APIs to list, fetch, and join tournaments without showing Lucra UI. Requires `LucraSDK.init` and a configured user.

## Get Recommended Tournaments

```ts
const tournaments = await LucraSDK.getRecomendedTournaments({
  includeClosed: true,
  limit: 50,
});
```

Example response:

```json
[
  {
    "id": "tournament-1",
    "title": "Weekend Pool",
    "type": "POOL",
    "fee": 5,
    "buyInAmount": 5,
    "description": "Win by placing in the top 10",
    "participants": [
      { "id": "user-1", "username": "alice", "place": 1, "rewardValue": 20 },
      { "id": "user-2", "username": "bob", "place": 2, "rewardValue": 10 }
    ],
    "status": "OPEN",
    "metadata": null,
    "iconUrl": "https://...",
    "expiresAt": "2024-01-01T00:00:00Z",
    "potTotal": 100
  }
]
```

Parameters:
- `includeClosed` (boolean): Include completed tournaments.
- `limit` (number): Max number of tournaments.

Returns: `Promise<PoolTournament[]>`

## Get Tournament Matchup

```ts
const tournament = await LucraSDK.tournamentMatchup('TOURNAMENT_ID');
```

Parameters:
- `tournamentId` (string): Tournament ID to fetch.

Returns: `Promise<PoolTournament>`

Example response:

```json
{
  "id": "tournament-1",
  "title": "Weekend Pool",
  "type": "POOL",
  "fee": 5,
  "buyInAmount": 5,
  "description": "Win by placing in the top 10",
  "participants": [
    { "id": "user-1", "username": "alice", "place": 1, "rewardValue": 20 },
    { "id": "user-2", "username": "bob", "place": 2, "rewardValue": 10 }
  ],
  "status": "OPEN",
  "metadata": null,
  "iconUrl": "https://...",
  "expiresAt": "2024-01-01T00:00:00Z",
  "potTotal": 100
}
```

## Join Tournament

```ts
await LucraSDK.joinTournament('TOURNAMENT_ID');
```

Parameters:
- `tournamentId` (string): Tournament ID to join.

Returns: `Promise<void>`

## Errors

Tournament calls (`getRecomendedTournaments`, `tournamentMatchup`, `joinTournament`) can throw `LucraSDKError` with:

- `notInitialized`: SDK/user session not ready
- `unverified`: User needs identity verification
- `notAllowed`: User restricted/suspended/banned
- `insufficientFunds`: Not enough balance for entry
- `missingDemographicInformation`: Missing required user info (e.g., email/zip for free tournaments)
- `locationError`: Location restriction/GeoComply failure/location services off
- `apiError`: Network/server/invalid response
- `unknown`: Unclassified error

### Error handling example

```ts
import { LucraSDK, type LucraSDKError } from '@lucra-sports/lucra-react-native-sdk';

try {
  await LucraSDK.joinTournament('TOURNAMENT_ID');
} catch (error) {
  const e = error as LucraSDKError;
  switch (e.code) {
    case 'notInitialized':
      // Ensure SDK init + user config
      break;
    case 'unverified':
      await LucraSDK.present({ name: LucraSDK.FLOW.VERIFY_IDENTITY });
      break;
    case 'insufficientFunds':
      await LucraSDK.present({ name: LucraSDK.FLOW.ADD_FUNDS });
      break;
    case 'missingDemographicInformation':
      await LucraSDK.present({ name: LucraSDK.FLOW.DEMOGRAPHIC_COLLECTION });
      break;
    case 'locationError':
      // Prompt user to enable location / check state eligibility
      break;
    case 'apiError':
      // Retry or show generic failure
      break;
    default:
      console.warn('Unknown tournament error', e);
  }
}
```

## Types

```ts
type PoolTournament = {
  id: string;
  title: string;
  type: string;
  fee: number;
  buyInAmount: number;
  description?: string;
  participants: PoolTournamentParticipant[];
  status: string;
  metadata?: string;
  iconUrl?: string;
  expiresAt?: string;
  potTotal: number;
};

type PoolTournamentParticipant = {
  id: string;
  username: string;
  place?: number;
  rewardValue?: number;
};
```

## Event: Tournament Joined

```ts
const unsubscribe = LucraSDK.addContestListener({
  onTournamentJoined: (tournamentId: string) => {
    console.log(`User joined tournament: ${tournamentId}`);
  },
});

// Call this when you no longer need the listener (e.g., on unmount).
unsubscribe();
```

## Usage examples

### Join with demographic prompt fallback

```ts
try {
  await LucraSDK.joinTournament('<tournament-id>');
} catch (e: any) {
  if (e.code === 'missingDemographicInformation') {
    LucraSDK.present({ name: LucraSDK.FLOW.DEMOGRAPHIC_COLLECTION });
  } else {
    throw e;
  }
}
```

### Launch demographic form directly

```ts
LucraSDK.present({ name: LucraSDK.FLOW.DEMOGRAPHIC_COLLECTION });
```

### Check user demographics before calling join

```ts
const user = await LucraSDK.getUser();
const isMissingDemo = !user.email || !user.address?.zip;
if (isMissingDemo) {
  LucraSDK.present({ name: LucraSDK.FLOW.DEMOGRAPHIC_COLLECTION });
}
```
